<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="Scripts/FlippyTextReader.js"></script>
    <link href="Style/Skeleton/skeleton.css" rel="stylesheet">
    <link href="Style/Skeleton/normalize.css" rel="stylessheet">
    <link href="Style/Style.css" rel = "stylesheet">
    <link href="Style/IconStyles.css" rel = "stylesheet">

    <script src="Scripts/userSession.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2/webcomponents-loader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="Scripts/config.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/SH20RAJ/ShowdownCSS@main/showdown.css">
</head>
<body class="LightMode" id="body">
    <div class="MainTitle">
        <h1 id="Title"></h1>
        
        <div id="UserSession"></div>
    </div>
    <div class="container MainBody" > 
        <div class="Row">
            <div class="twelve columns UserSettings">
                <div>
                    <span class="backButton" onclick="window.history.go(-1);">â¬… Settings</span>
                </div>

                <img id="UserIcon" class='UserIcon' src='Style/Images/DefaultUserProfile.png'>
                <h2 id="Alias"></h2>
                <h4 id="UsernameDisplay"></h4>
                <hr>
                <ul>
                    <li>
                        Toggle Light Mode
                        <button class="ModeSwitch" onclick="ToggleDarkMode()">Light/Dark</button>
                    </li>
                    <li class="link" onclick="window.location.href='UserDetails.html'">
                        Edit User Profile
                    </li>
                </ul>
                <hr>
                <ul>
                    <li class="link logout" onclick="ClearLogin()">
                        Logout
                     </li>
                </ul>
            </div>            
        </div>
    </div>
</body>
<script>

    $('#UserDetailsForm').submit(function (e) {
        e.preventDefault();
        var fd = new FormData($(this)[0]);
        $.ajax({
            url: 'http://localhost:3000/UserModification',
            data: fd,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function(data){
                console.log(data);
            }
        });
    });

    $session = {
        UserID:""
    }

    $(document).ready(function() {
        // check login
        checkLogin()

        //get user details
       
        GetUserDetails(GetUserSession()).then(result => {
            //fill in user details
            document.getElementById('Alias').innerHTML = result.UserData.Alias
            document.getElementById('UsernameDisplay').innerHTML = result.Username
            document.getElementById("UserIcon").src = `http://localhost:3000/GetUserPfp?SessionID=${GetUserSession()}`

            // if(["She/Her","He/Him","They/Them"].includes(result.UserData.ProNouns)){
            //     document.getElementById('Pronouns').value = result.UserData.ProNouns
            // }else{
            //     document.getElementById('Pronouns').value = "Other"
            //     document.getElementById('OptionalPronoun').value = result.UserData.ProNouns
            // }

            // if(result.UserData.Links.length > 0){
            //     result.UserData.Links.forEach(link => {
            //         AddLink(link.Title, link.Username)
            //     });
            // }
        });


        async function GetUserDetails(UserID) {
            const response = await fetch(`http://${CONFIG.nodeserver}:${CONFIG.nodeport}/GetUserDetails`, {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify({
                    SessionID : UserID,
                })
            });

            return response.json()
        }

        if(localStorage.DarkMode == undefined){
            localStorage.setItem('DarkMode',false)
            document.getElementById("body").classList.add("LightMode")
        }

        if(localStorage.DarkMode == "false"){
            document.getElementById("body").classList.remove("DarkMode")
            document.getElementById("body").classList.add("LightMode")
        }else{
            document.getElementById("body").classList.remove("LightMode")
            document.getElementById("body").classList.add("DarkMode")
        }
    })

    
        function ToggleDarkMode(){
            if(localStorage.DarkMode == "true"){
                localStorage.setItem('DarkMode',false)
                document.getElementById("body").classList.remove("DarkMode")
                document.getElementById("body").classList.add("LightMode")
            }else{
                localStorage.setItem('DarkMode',true)
                document.getElementById("body").classList.remove("LightMode")
                document.getElementById("body").classList.add("DarkMode")
            }
        }


</script>
</html>